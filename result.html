<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ูุชุฌู ูุณุงุจูู</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="background-main">

    <!-- ุจุงูุง ุตูุญู: ููฺฏู -->
    <div class="top-header">
      <img class="logo" src="assets/images/logo-main.png" alt="ููฺฏู">
    </div>

    <!-- ูุงุญู ูุชุฌู -->
    <main class="result-box neon-box">
      <h1>๐ ุชุจุฑฺฉ! ๐</h1>
      <p>ุงูุชุงุฒ ููุง ุดูุง: <span id="final-score">0</span></p>
      <p id="rank-text"></p>
      
      <!-- ุจูุฑ ฺฉุงุฑุงฺฉุชุฑ -->
      <div class="user-banner">
        <img id="banner-character" src="" alt="ฺฉุงุฑุงฺฉุชุฑ">
        <p id="banner-text">ุจูุฑ ุงุฎุชุตุงุต ุดูุง โ ุฎูุด ุขูุฏุฏ!</p>
      </div>

      <!-- ุฏุนูุช ุงุฒ ุฏูุณุชุงู -->
      <div class="invite-box neon-box">
        <p>ุจุฑุง ฺฉุณุจ ุงูุชุงุฒ ุจุดุชุฑุ ููฺฉ ุงุฎุชุตุงุต ุฏุนูุช ุฎูุฏ ุฑุง ุจู ุฏูุณุชุงู ุจุฏูุฏ:</p>
        <input id="final-invite" readonly>
        <button id="copy-invite" class="btn-small">ฺฉูพ ููฺฉ</button>
        <p id="ref-count"></p>
      </div>

      <!-- ุจุงุฒฺฏุดุช ุจู ุตูุญู ุงุตู -->
      <div style="margin-top:16px;">
        <button onclick="location.href='index.html'" class="btn-primary">ุจุงุฒฺฏุดุช ุจู ุตูุญู ุงุตู</button>
      </div>
    </main>

  </div>

  <script>
    // ููุงุด ุงูุชุงุฒ ููุง
    const finalScore = localStorage.getItem('finalScore') || 0;
    document.getElementById('final-score').innerText = finalScore;

    // ููุงุด ฺฉุงุฑุงฺฉุชุฑ ุงูุชุฎุงุจโุดุฏู
    const selectedCharacter = localStorage.getItem('selectedCharacter') || 'female';
    document.getElementById('banner-character').src = `assets/images/character_${selectedCharacter}.jpeg`;

    // ุชุนู ุฑุชุจู ูุฑุถ ุจุฑุง ููุฑุงุช ุงูู ุชุง ุณูู
    let rankText = '';
    if(finalScore >= 25){
      rankText = '๐ฅ ุชุจุฑฺฉ! ุดูุง ููุฑ ุงูู ูุณุงุจูู ูุณุชุฏ ู ุฌุงุฒู ุฏุฑุงูุช ูโฺฉูุฏ!';
    } else if(finalScore >= 20){
      rankText = '๐ฅ ุขูุฑู! ุดูุง ููุฑ ุฏูู ูุณุชุฏ.';
    } else if(finalScore >= 15){
      rankText = '๐ฅ ุนุงู! ุดูุง ููุฑ ุณูู ูุณุชุฏ.';
    } else {
      rankText = '๐ก ุจุง ุงูุชุงุฒ ฺฉุณุจ ุดุฏูุ ุชูุฑู ู ุชูุงุด ุจุดุชุฑ ุจุฑุง ุฑุชุจูโูุง ุจุงูุงุชุฑ ุฏุงุดุชู ุจุงุดุฏ!';
    }
    document.getElementById('rank-text').innerText = rankText;

    // ููฺฉ ุฏุนูุช ุงุฎุชุตุงุต
    let userInviteId = localStorage.getItem('userInviteId');
    if(!userInviteId){
      userInviteId = Math.floor(Math.random()*900000+100000).toString();
      localStorage.setItem('userInviteId', userInviteId);
    }
    const inviteInput = document.getElementById('final-invite');
    inviteInput.value = window.location.origin + window.location.pathname.replace(/[^/]*$/,'') + 'quiz.html?ref=' + userInviteId;

    // ููุงุด ุชุนุฏุงุฏ ุงูุฑุงุฏ ฺฉู ุจุง ููฺฉ ฺฉุงุฑุจุฑ ุนุถู ุดุฏูโุงูุฏ
    const referrals = JSON.parse(localStorage.getItem('referrals')||'{}');
    const refCount = referrals[userInviteId] || 0;
    document.getElementById('ref-count').innerText = `ุชุนุฏุงุฏ ุงูุฑุงุฏ ฺฉู ุจุง ููฺฉ ุดูุง ุนุถู ุดุฏูุฏ: ${refCount}`;

    // ุฏฺฉูู ฺฉูพ ููฺฉ
    document.getElementById('copy-invite').addEventListener('click', ()=>{
      inviteInput.select();
      inviteInput.setSelectionRange(0, 99999);
      document.execCommand('copy');
      alert('ููฺฉ ุฏุนูุช ฺฉูพ ุดุฏ!');
    });

    // ูพุงฺฉโฺฉุฑุฏู ุฏุงุฏูโูุง ูููุช (optional)
    localStorage.removeItem('ongoingScore');
  </script>
</body>
</html>
